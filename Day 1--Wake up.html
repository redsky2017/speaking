<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Day 1: Wake Up (V4 ç‚¹è¯»ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; touch-action: manipulation; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .btn-press:active { transform: scale(0.95); opacity: 0.8; }
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* ç®€å•çš„æ¨¡ç³Šæ•ˆæœç”¨äºéšè—ç¿»è¯‘ */
        .blur-reveal { filter: blur(8px); opacity: 0.6; transition: all 0.3s ease; user-select: none; }
        .blur-reveal.revealed { filter: blur(0); opacity: 1; }
    </style>
</head>
<body class="bg-yellow-50 text-gray-800 select-none">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // å›¾æ ‡ç»„ä»¶
        const IconSun = () => <span className="text-6xl">â˜€ï¸</span>;
        const IconUp = () => <span className="text-6xl">â¬†ï¸</span>;
        const IconWake = () => <span className="text-6xl">ğŸ¥±</span>;
        const IconVolume = () => <span>ğŸ”Š</span>;
        const IconPlay = () => <span>â–¶ï¸</span>;
        const IconStop = () => <span>â¹ï¸</span>;
        const IconCheck = () => <span className="text-orange-500">âœ…</span>;
        const IconCircle = () => <div className="w-5 h-5 rounded-full border-2 border-gray-300"></div>;
        const IconEye = () => <span>ğŸ‘ï¸</span>;

        const Day1App = () => {
            const [activeTab, setActiveTab] = useState('learn');
            const [currentVocabIndex, setCurrentVocabIndex] = useState(0); // å•è¯å¡ç‰‡ç´¢å¼•
            const [showTranslation, setShowTranslation] = useState(false); // æ˜¯å¦æ˜¾ç¤ºç¿»è¯‘
            const [currentStep, setCurrentStep] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            const audioRef = useRef(null);

            // è§¦æ‘¸æ»‘åŠ¨ç›¸å…³çŠ¶æ€
            const touchStartX = useRef(0);
            const touchEndX = useRef(0);

            // æ•°æ®å†…å®¹ï¼šå¢åŠ äº† audioFile å­—æ®µ
            const content = {
                title: "Day 1: Wake up!",
                vocab: [
                    { 
                        word: "Sun", 
                        cn: "å¤ªé˜³", 
                        icon: <IconSun />, 
                        sentence: "The sun is up.", 
                        audioWord: "word_sun.mp3",
                        audioSent: "sent_sun.mp3"
                    },
                    { 
                        word: "Up", 
                        cn: "å‘ä¸Š / èµ·æ¥", 
                        icon: <IconUp />, 
                        sentence: "Hands up!", 
                        audioWord: "word_up.mp3",
                        audioSent: "sent_up.mp3"
                    },
                    { 
                        word: "Wake up", 
                        cn: "é†’é†’ / èµ·åºŠ", 
                        icon: <IconWake />, 
                        sentence: "Wake up, baby!", 
                        audioWord: "word_wakeup.mp3",
                        audioSent: "sent_wakeup.mp3"
                    }
                ],
                script: [
                    { step: 1, action: "åŠ¨ä½œï¼šæ‹‰çª—å¸˜", parentSay: "Good morning! Look, the Sun!", cn: "çœ‹ï¼Œå¤ªé˜³å‡ºæ¥å•¦ï¼", tip: "è¯­æ°”è¦å¤¸å¼ ", audio: "guide_step1.mp3" },
                    { step: 2, action: "åŠ¨ä½œï¼šæ‰‹ä¸¾é«˜", parentSay: "The sun is UP. Hands UP!", cn: "æŠŠæ‰‹ä¸¾èµ·æ¥ï¼", tip: "å¼ºè°ƒ UP", audio: "guide_step2.mp3" },
                    { step: 3, action: "åŠ¨ä½œï¼šæŒ ç—’ç—’", parentSay: "Tickle, tickle... Wake up!", cn: "å¿«é†’é†’ï¼", tip: "ç¬‘ç€å”¤é†’", audio: "guide_step3.mp3" }
                ],
                scenarioAudio: "scenario_full.mp3"
            };

            // æ ¸å¿ƒéŸ³é¢‘æ’­æ”¾é€»è¾‘
            const playAudio = (filename, fallbackText) => {
                if (isPlaying && audioRef.current) {
                    audioRef.current.pause();
                    audioRef.current = null;
                    setIsPlaying(false);
                    return;
                }

                setIsPlaying(true);

                // å°è¯•æ’­æ”¾ mp3
                const audio = new Audio(filename);
                audioRef.current = audio;

                audio.play()
                    .then(() => {
                        console.log("Playing audio file:", filename);
                    })
                    .catch((err) => {
                        console.warn("éŸ³é¢‘æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œä½¿ç”¨åˆæˆè¯­éŸ³å…œåº•:", filename);
                        // å¦‚æœæ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œé™çº§ä½¿ç”¨ TTS
                        speakFallback(fallbackText);
                    });

                audio.onended = () => {
                    setIsPlaying(false);
                };
            };

            // å…œåº•çš„ TTS è¯­éŸ³åˆæˆ
            const speakFallback = (text) => {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                utterance.onend = () => setIsPlaying(false);
                window.speechSynthesis.speak(utterance);
            };

            // åˆ‡æ¢å¡ç‰‡é€»è¾‘
            const nextCard = () => {
                if (currentVocabIndex < content.vocab.length - 1) {
                    setCurrentVocabIndex(prev => prev + 1);
                    setShowTranslation(false); // åˆ‡æ¢å¡ç‰‡æ—¶é‡ç½®ç¿»è¯‘éšè—çŠ¶æ€
                }
            };

            const prevCard = () => {
                if (currentVocabIndex > 0) {
                    setCurrentVocabIndex(prev => prev - 1);
                    setShowTranslation(false);
                }
            };

            // æ»‘åŠ¨å¤„ç†
            const handleTouchStart = (e) => { touchStartX.current = e.targetTouches[0].clientX; };
            const handleTouchMove = (e) => { touchEndX.current = e.targetTouches[0].clientX; };
            const handleTouchEnd = () => {
                if (!touchStartX.current || !touchEndX.current) return;
                const diff = touchStartX.current - touchEndX.current;
                if (diff > 50) nextCard(); // å·¦æ»‘ -> ä¸‹ä¸€ä¸ª
                if (diff < -50) prevCard(); // å³æ»‘ -> ä¸Šä¸€ä¸ª
                touchStartX.current = 0; touchEndX.current = 0;
            };

            return (
                <div className="flex flex-col min-h-screen pb-20 max-w-md mx-auto bg-yellow-50 shadow-2xl overflow-hidden relative">
                    
                    {/* Header */}
                    <header className="bg-orange-400 text-white p-4 shadow-md text-center sticky top-0 z-10">
                        <h1 className="text-xl font-bold flex items-center justify-center gap-2">
                            â˜€ï¸ {content.title}
                        </h1>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 p-4 w-full flex flex-col justify-center">
                        
                        {/* TAB 1: å­¦å•è¯ (å¡ç‰‡æ¨¡å¼) */}
                        {activeTab === 'learn' && (() => {
                            const item = content.vocab[currentVocabIndex];
                            return (
                                <div 
                                    className="flex-1 flex flex-col justify-center items-center space-y-6 animate-fade-in"
                                    onTouchStart={handleTouchStart}
                                    onTouchMove={handleTouchMove}
                                    onTouchEnd={handleTouchEnd}
                                >
                                    {/* é¡¶éƒ¨è¿›åº¦æ¡ */}
                                    <div className="flex gap-2 mb-2">
                                        {content.vocab.map((_, idx) => (
                                            <div key={idx} className={`h-2 rounded-full transition-all duration-300 ${idx === currentVocabIndex ? 'w-8 bg-orange-500' : 'w-2 bg-gray-300'}`}></div>
                                        ))}
                                    </div>

                                    {/* å•è¯ä¸»å¡ç‰‡ */}
                                    <div className="bg-white w-full rounded-3xl p-8 shadow-xl flex flex-col items-center relative min-h-[400px] justify-between border-b-8 border-orange-100">
                                        
                                        <div className="flex-1 flex flex-col items-center justify-center w-full">
                                            {/* å›¾æ ‡ */}
                                            <div className="mb-6 transform scale-110">{item.icon}</div>
                                            
                                            {/* è‹±æ–‡å•è¯ (ç‚¹å‡»å‘éŸ³) */}
                                            <h3 
                                                className="text-5xl font-extrabold text-gray-800 mb-2 cursor-pointer active:text-orange-500 active:scale-95 transition-transform"
                                                onClick={() => playAudio(item.audioWord, item.word)}
                                            >
                                                {item.word} <span className="text-lg text-orange-400 ml-1">ğŸ”ˆ</span>
                                            </h3>
                                            <p className="text-xs text-gray-400 mb-6">(ç‚¹å‡»å•è¯æ’­æ”¾è¯»éŸ³)</p>

                                            {/* ä¸­æ–‡ç¿»è¯‘ (ç‚¹å‡»æ˜¾ç¤º) */}
                                            <div 
                                                onClick={() => setShowTranslation(true)}
                                                className="w-full text-center py-4 px-2 rounded-xl bg-gray-50 cursor-pointer"
                                            >
                                                <p className={`text-xl font-medium text-gray-600 transition-all duration-500 ${showTranslation ? 'opacity-100 blur-0' : 'opacity-0 blur-md'}`}>
                                                    {item.cn}
                                                </p>
                                                {!showTranslation && <p className="text-xs text-gray-400 mt-[-20px]">ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹ç¿»è¯‘</p>}
                                            </div>
                                        </div>

                                        {/* åº•éƒ¨ä¾‹å¥ */}
                                        <div className="w-full mt-6 bg-orange-50 rounded-2xl p-4 flex items-center justify-between border border-orange-100">
                                            <span className="text-orange-900 font-medium text-lg italic">"{item.sentence}"</span>
                                            <button 
                                                onClick={() => playAudio(item.audioSent, item.sentence)} 
                                                className="btn-press bg-orange-400 text-white p-3 rounded-full shadow-lg hover:bg-orange-500 transition ml-3"
                                            >
                                                <IconVolume />
                                            </button>
                                        </div>
                                    </div>

                                    {/* å·¦å³åˆ‡æ¢æŒ‰é’® (è¾…åŠ©) */}
                                    <div className="flex justify-between w-full px-4 text-gray-400">
                                        <button onClick={prevCard} disabled={currentVocabIndex === 0} className="disabled:opacity-20 p-2 text-3xl">â¬…ï¸</button>
                                        <span className="text-sm mt-2 opacity-50">å·¦å³æ»‘åŠ¨åˆ‡æ¢</span>
                                        <button onClick={nextCard} disabled={currentVocabIndex === content.vocab.length - 1} className="disabled:opacity-20 p-2 text-3xl">â¡ï¸</button>
                                    </div>
                                </div>
                            );
                        })()}

                        {/* TAB 2: ç£¨è€³æœµ */}
                        {activeTab === 'audio' && (
                            <div className="bg-white rounded-2xl p-6 shadow-lg text-center space-y-6 mt-4">
                                <div className="text-6xl animate-bounce">ğŸ”</div>
                                <div>
                                    <h2 className="text-xl font-bold">æ—©å®‰ç£¨è€³æœµ</h2>
                                    <p className="text-gray-500 text-sm mt-1">æƒ…æ™¯è¯­éŸ³æ¼”ç¤º</p>
                                </div>
                                <div className="bg-gray-100 rounded-xl p-4 text-left">
                                    <p className="text-gray-600 font-mono text-sm leading-relaxed">
                                        "Cock-a-doodle-doo! <br/>
                                        Good morning! <br/>
                                        The <b>Sun</b> is <b>up</b>. <br/>
                                        It is time to... <b>Wake up</b>!"
                                    </p>
                                </div>
                                <button 
                                    onClick={() => playAudio(content.scenarioAudio, "Cock-a-doodle-doo! Good morning! The sun is up.")} 
                                    className={`btn-press w-full py-4 rounded-xl flex items-center justify-center gap-2 font-bold text-lg transition ${isPlaying ? 'bg-red-500 text-white' : 'bg-green-500 text-white shadow-lg'}`}
                                >
                                    {isPlaying ? <><IconStop /> åœæ­¢</> : <><IconPlay /> æ’­æ”¾å®Œæ•´éŸ³é¢‘</>}
                                </button>
                                <p className="text-xs text-red-400 bg-red-50 p-2 rounded">* è¯·ç¡®ä¿ mp3 æ–‡ä»¶å·²æ”¾å…¥åŒçº§ç›®å½•ï¼Œå¦åˆ™å°†æ’­æ”¾åˆæˆè¯­éŸ³ã€‚</p>
                            </div>
                        )}

                        {/* TAB 3: çœ‹å‰§æœ¬ */}
                        {activeTab === 'guide' && (
                            <div className="space-y-4">
                                {content.script.map((step, index) => (
                                    <div key={index} className={`bg-white rounded-xl shadow overflow-hidden transition-all duration-300 ${currentStep === index ? 'ring-2 ring-orange-400' : 'opacity-90'}`}>
                                        <div className="p-3 cursor-pointer flex justify-between items-center bg-gray-50 border-b" onClick={() => setCurrentStep(index)}>
                                            <span className="font-bold text-gray-700">Step {step.step}</span>
                                            {currentStep === index ? <IconCheck /> : <IconCircle />}
                                        </div>
                                        {currentStep === index && (
                                            <div className="p-4 space-y-3">
                                                <div className="text-sm text-purple-700 bg-purple-50 p-2 rounded font-medium">â˜… {step.action}</div>
                                                <div className="bg-orange-50 p-3 rounded-xl border border-orange-100 relative">
                                                    <p className="text-xs text-gray-400 uppercase tracking-wide mb-1">å®¶é•¿è¯´:</p>
                                                    <p className="text-lg font-bold text-gray-800 pr-8">{step.parentSay}</p>
                                                    <button onClick={() => playAudio(step.audio, step.parentSay)} className="absolute right-2 top-2 text-orange-500 p-2 btn-press">
                                                        <IconVolume />
                                                    </button>
                                                </div>
                                                <p className="text-xs text-gray-400 italic text-center">"{step.tip}"</p>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {/* Bottom Nav */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 pb-safe shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-20 max-w-md mx-auto">
                        <button onClick={() => setActiveTab('learn')} className={`flex flex-col items-center p-2 rounded-lg flex-1 ${activeTab === 'learn' ? 'text-orange-500' : 'text-gray-400'}`}>
                            <span className="text-xl">ğŸ“–</span><span className="text-xs font-medium">å•è¯</span>
                        </button>
                        <button onClick={() => setActiveTab('audio')} className={`flex flex-col items-center p-2 rounded-lg flex-1 ${activeTab === 'audio' ? 'text-orange-500' : 'text-gray-400'}`}>
                            <span className="text-xl">ğŸµ</span><span className="text-xs font-medium">ç£¨è€³æœµ</span>
                        </button>
                        <button onClick={() => setActiveTab('guide')} className={`flex flex-col items-center p-2 rounded-lg flex-1 ${activeTab === 'guide' ? 'text-orange-500' : 'text-gray-400'}`}>
                            <span className="text-xl">ğŸ“‹</span><span className="text-xs font-medium">å‰§æœ¬</span>
                        </button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Day1App />);
    </script>
</body>
</html>
